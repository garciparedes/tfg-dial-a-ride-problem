% !TEX root = ../../document.tex

\documentclass{subfiles}

\begin{document}

  \chapter{Formulación del Problema}
  \label{chap:formulation}

    \section{Introducción}
    \label{sec:formulation_introduction}

      \paragraph{}
      El problema \emph{Dial-a-Ride}, o \emph{DARP} en modo abreviado representa una de las modelizaciones más interesantes en el ámbito de los problemas de \emph{optimización combinatoria}. Esto se debe a la gran cantidad de situaciones del mundo real que pueden ser representadas siguiendo dicho esquema. Sin embargo, antes de profundizar en los aspectos más detallados que caracterizan el problema de recogidas y entregas, es necesario describir el contexto del mismo, así como la clase a la cual pertenece. Una vez se haya completado dicha tarea, se estará en condiciones necesarias para poder describir tanto la versión básica como las extensiones más interesantes, tanto desde el punto de vista de los aspectos matemáticos, como desde la cantidad de situaciones reales que permiten resolver.

      \paragraph{}
      En cuanto a la organización del capítulo, en el \cref{sec:formulation_contextualization} se describe de manera detallada el problema \emph{Dial-a-Ride} desde el punto de vista de la jerarquía de clases a la cual pertenecen siguiendo un enfoque descendente (o \emph{top-down}) en los \cref{sec:formulation_optimization_problems,sec:formulation_linear_problems,sec:formulation_combinatorial_problems,sec:formulation_generalized_pickup_and_delivery_problems,sec:formulation_routing_pickup_and_delivery_problems,sec:formulation_dial_a_ride_problems}. Seguidamente, en el apartado \cref{sec:formulation_notation} se indica la notación que se pretende seguir a lo largo del documento (y que pretende ser utilizada a modo de referencia en capítulos posteriores). El siguiente paso es determinar la \emph{Formulación Básica}, lo cual se lleva a cabo en el \cref{sec:formulation_basic_formulation}. Posteriormente se indican restricciones addicionales en el \cref{sec:formulation_aditional_restrictions} para después hablar acerca de las posibles \emph{Funciones Objetivo} en el \cref{sec:formulation_objective_functions}. En el \cref{sec:formulation_real_time} se discuten las peculiaridades del problema cuando se aplica en situaciones en tiempo real. Finalmente, en el \cref{sec:formulation_conclusions} se describen brevemente los aspectos más importantes del capítulo.

    \section{Contextualización del problema}
    \label{sec:formulation_contextualization}

      \paragraph{}
      A continuación se procede a describir la clase de problemas matemáticos a la cual pertenece el problema \emph{Dial-a-Ride}. Dicha descripción se llevará a cabo de fuera hacia dentro, esto es desde la categoría de problemas más amplia hasta la más concreta, pasando por una breve contextualización así como ejemplificación de problemas similares.

      \subsection{Problemas de Optimización}
      \label{sec:formulation_optimization_problems}

        \paragraph{}
        La clase de \emph{problemas de optimización} representa una de las áreas de investigación más interesante en la actualidad, ya que muchas de las innovaciones obtenidas en dicho campo permiten resolver problemas aplicables al mundo real de manera práctica que antes únicamente podían ser resueltos teóricamente. En concreto, los problemas de optimización son aquellos que se basan en la minimización (o maximización) de una determinada función objetivo (posiblemente vectorial, lo cual define modelos multiobjetivo) de manera que se satisfaga un conjunto de restricciones previamente fijadas sobre un conjunto de variables de decisión que afectan mutuamente a la satisfacibilidad de las restricciones y el valor de la función objetivo.

        \paragraph{}
        Dichas variables de decisión pueden ser tanto categóricas como numéricas (discretas o continuas), lo cual genera una gran cantidad de subproblemas diferences (Nótese que las variables categóricas con $k$ niveles diferentes pueden ser representadas de manera sencilla a partir de $k-1$ variables binarias). De la misma manera, tanto el valor de función objetivo como las restricciones pueden tener una naturaleza muy diferente: estas pueden estar formadas por funciones lineales de las variables de decisión, como por complicadas funciones no lineales que complican el proceso de obtención del valor óptimo del problema. De manera matemática, la \cref{eq:general_optimization_formulation} define la formulación de optimización, donde tanto las funciones $f_i(\cdot)$ como $g_k(\cdot)$ son funciones arbitrarias que proyectan el vector de variables de decisión $n$-dimensional $\mathbf{x}$ en un espacio unidimensional (generando un valor escalar).

        \begin{eqfloat}
          \begin{equation}
            \begin{array}{rr@{}ll}
              \underset{\mathbf{x} \in \mathbb{R}^{n}}{\text{Minimizar}} & f_i(\mathbf{x}) &                 ,& \forall i \in \{1,...,I\} \\
              \text{sujeto a}	 & g_k(\mathbf{x}) \ &\leq 0, & \forall k \in \{1,...,K\}
            \end{array}
          \end{equation}
          \caption{Formulación del modelo de Optimización General}
          \label{eq:general_optimization_formulation}
        \end{eqfloat}

        \paragraph{}
        Muchos de los problemas que resolvemos a diario en nuestra vida cotidiana son en cierta medida \emph{problemas de optimización}, desde qué elementos decidimos añadir a nuestra mochila cada día (basados en restricciones de capacidad, funciones objetivo de utilidad y variables de decisión binarias) hasta el la detección del rostro por nuestros teléfonos móviles para aplicar un filtro de la manera más realista posible en una videollamada (basados en restricciones de forma, funciones objetivo multidimensionales y millones de variables de decisión numéricas).

      \subsection{Problemas de Optimización Lineal}
      \label{sec:formulation_linear_problems}

        \paragraph{}
        Una de las categorías de problemas de optimización más ampliamente estudiados por su relativa simplicidad (ya se han desarrollado métodos capaces de obtener soluciones óptimas en un número reducido de pasos) y su gran capacidad de modelización ante muchas situaciones del mundo real son los \emph{problemas de optimización lineal}. Dichos problemas se caracterizan por estar compuestos por variables de decisión compuestas por transformaciones lineales respecto de la función objetivo. Esto quiere decir que tanto el valor de la función objetivo como las posibles restricciones escritas en forma de desigualdades están compuestas por sumas de las variables de decisión multiplicadas por determinados pesos.

        \paragraph{}
        En la \cref{eq:linear_optimization_formulation} se muestra a modo de ejemplo la formulación de un problema de optimización lineal (del cual se hablará posteriormente). Como se puede apreciar, en este caso las funciones arbitrarias definidas en la formulación general han sido sustituidas por transformaciones lineales respecto de las variables de decisión. Para la resolución de problemas de este tipo se han desarrollado una gran cantidad de métodos, entre los que destaca un algoritmo altamente eficiente el cual se conoce como \emph{Simplex} \cite{klee1970good}. Este algoritmo se basa en pivotaje entre soluciones de manera que tras cada iteracción se llegue a una solución igual o mejor. Una de las mayores ventajas de la formulación de un problema como lineal es que algoritmos como \emph{Simplex} proporcionan garantias de optimalidad al alcanzar el valor óptimo al terminar completamente su ejecución.

        \begin{eqfloat}
          \begin{equation}
            \begin{array}{rr@{}ll}
              \text{Minimizar} & \sum\limits_{i = 1}^{N}\sum\limits_{j = 1}^{M}  c_{ij}x_{ij} &                 & \\
              \text{sujeto a}	 & \sum\limits_{i = 1}^{N} x_{ij} \ &= s_{i}, & \forall i \in \{1,...,N\} \\
                               & \sum\limits_{j = 1}^{M} x_{ij} \ &= d_{j}, & \forall j \in \{1,...,M\} \\
                               &                               	x_{ij} 	&\geq 0, 	                 & \forall i \in \{1,...,N\},\forall j \in \{1,...,M\}
            \end{array}
          \end{equation}
          \caption{Formulación de un modelo de \emph{Optimización Lineal}. En concreto, el \emph{Problema de Transporte}.}
          \label{eq:linear_optimization_formulation}
        \end{eqfloat}

        \paragraph{}
        A pesar de que el algoritmo \emph{Simplex} siempre proporcione resultados óptimos, en algunas ocasiones no se posee la capacidad suficiente de cálculo para llegar a la mejor solución. Por lo tanto, se han desarrollado una gran cantidad de métodos conocidos como \emph{heurísticos} (de los cuáles se hablará más en detalle en el \cref{chap:heuristics} y \cref{chap:metaheuristics}) que a pesar de proporcionar unos buenos resultados, no ofrecen ninguna garantia de optimalidad. Por contra, también existen otros métodos exactos que son capaces de llegar al valor óptimo utilizando menor cantidad de recursos (algunos de los cuales se describen en el \cref{chap:exacts}).

        \paragraph{}
        Antes de describir algunos de los ejemplos y aplicaciones reales más destacadas basadas en \emph{problemas de optimización lineal}, es necesario describir unos de los problemas más populares de esta categoria, el cual se conoce como \emph{problema de transporte} y se caracteriza por permitir representar de manera matemática la tarea sobre cómo distribuir un conjunto de recursos procedentes de $N$ puntos de origen hasta $M$ puntos de destino, donde cada trayecto tiene un coste diferente, y cada origen y destino unas capacidades de oferta y demanda. La formulación sobre dicho problema se corresponde con la utilizada a modo de ejemplo en la \cref{eq:linear_optimization_formulation}.

        \paragraph{}
        Sin embargo, los problemas de optimización lineal permiten representar una amplia cantidad de situaciones de nuestra vida diaria. Entre ellos se encuentran los \emph{problemas de mezclas} (donde se pretende generar un compuesto con unas ciertas características a partir de la combinación de otros tratando de reducir los costes) aunque los problemas de optimización lineal también son de gran utilidad en el ámbito de la economia y los estudios de mercado, permitiendo representar de una manera relativamente sencilla el comportamiento de los clientes ante cambios de precio u otras variables más elaboradas.

      \subsection{Problemas de Optimización Combinatoria}
      \label{sec:formulation_combinatorial_problems}

        \paragraph{}
        Uno de los factores más relevantes cuando se trata de \emph{problemas de optimización lineal} se refiere a l naturaleza de las variables de decisión, en que (como se ha comentado anteriormente) estas pueden ser de una naturaleza continua o discreta. En este sentido, los problemas pueden clasificarse en 4 categorías: problemas de optimización continua puros (donde existen métodos muy eficientes que permiten ser resueltos en un tiempo razonable), problemas de \emph{optimización entera}, problemas de optimización binaria (o de \emph{optimización combinatoria}) y problema de optimización mixtos (donde mezclan ambos tipos de variables). Para profundizar más en el tema de la \emph{optimización entera} y \emph{optimización combinatoria} se recomienda \cite{wolsey2014integer}

        \paragraph{}
        A pesar de que la exigencia de que las variables de decisión sean discretas en un primer momento puede parecer muy sencilla en un primer momento (por ser muy intuitiva a nivel conceptual), esta complica mucho la labor de optimización del problema. En modo abstracto, esto se debe a que si el espacio de soluciones de un problema de optimización lineal era visto como un prima en un espacio $n$-dimensional (donde $n$ es el número de variables de decisión) y los puntos de interés se refieren a los vértices, que presentarán el máximo/mínimo valor óptimo, en el caso de las variables discretas el prima se transforma en una estructura \say{pixelada} lo cual incrementa de manera exponencial el número de vértices (y por tanto de puntos de evaluación) del problema en la búsqueda del valor óptimo.

        \paragraph{}
        Las dificultades descritas en el párrafo anterior provocan que la clase de problemas de optimización de variables discretas, entre los que se encuentra la de los problemas de optimización combinatoria (a la cuál a su vez pertenecen los de rutas, de los que se hablará posterirmente), hacen que el espacio de soluciones se extienda de tal manera que para casos relativamente pequeños, este sea inabordable. A pesar de existir métodos exactos (de los cuales se hablará en el \cref{chap:exacts}), la mayor parte de la literatura sobre este tema se ha dedicado a la investigación de métodos que a pesar de no ofrecer garantías de optimalidad, proporcionan un buen acuerdo entre eficiencia computacional y calidad de las soluciones obtenidas (los cuales se detallan en los \cref{chap:heuristics,chap:metaheuristics}).

        \begin{eqfloat}
          \begin{equation}
            \begin{array}{rr@{}ll}
              \text{Maximizar} & \sum\limits_{i = 1}^{N} u_{i}x_{i} &                 & \\
              \text{sujeto a}	 & \sum\limits_{i = 1}^{N} w_{i}x_{i} \ &\leq W, & \forall i \in \{1,...,N\} \\
                               &                             	x_{i} 	&\in \{0, 1\}, 	                 & \forall i \in \{1,...,N\}
            \end{array}
          \end{equation}
          \caption{Formulación de un modelo de \emph{Optimización Combinatoria}. En concreto, el \emph{Problema de la Mochila}.}
          \label{eq:combinatorial_optimization_formulation}
        \end{eqfloat}

        \paragraph{}
        Los problemas de \emph{optimización combinatatoria} se caracterizan porque las variables de decisión del modelo son de caracter binario. Dicha razón permite representar situaciones muy interesantes y diversas del mundo real, lo cual ha hecho que los campos de aplicaciones de este tipo de problemas sean desde la generación de rutas de vehículos con garantías de conectividad, hasta problemas de decisión relacionados con la toma o no de una determinada acción. Dentro de los problemas de decisión, existe uno que destaca sobre el resto por su relativa simplicidad teórica, pero a la vez extremada practicidad, el cual se conoce como \emph{problema de la mochila}. A pesar de tener muchas vertientes y extensiones, la idea básica de este es la de maximizar el valor en el proceso de selección de un subconjunto de elementos, dadas unas limitaciones de capacidad y un valor determinado para cada producto. La \say{dificultad} de este modelo reside en que los elementos no pueden ser escogidos parcialmente, por lo que surge un problema de combinatoria entre los elementos que añadir o no al subconjunto que forma la solución. A modo de ejemplo, en la \cref{eq:combinatorial_optimization_formulation} se muestra la versión más básica del \emph{problema de la mochila}, donde tal y como se puede apreciar, las variables de decisión tan solo pueden tomar valores $\{0, 1\}$ lo cual determina la presencia o no del elemento $i$-ésimo en el subconjunto solución.

        \paragraph{}
        Tal y como se ha remarcado a lo largo de todo el apartado, es especialmente importante remarcar que la mayor dificultad surgida al añadir las restriciones en el soporte de las variables de decisión genera un mayor espacio de puntos de evaluación, lo cual complica extremadamente los métodos de generación de soluciones. Por contra, esta dificultad amplia en gran medida la capacidad de representación de los modelos, lo cual es algo beneficioso ya que permite aprovechar en mayor medida recursos que de otra forma serían imposibles de aprovechar de la misma manera.

      \subsection{Problemas Generalizados de Recogidas y Entregas}
      \label{sec:formulation_generalized_pickup_and_delivery_problems}

        \paragraph{}
        Los problemas de optimización descritos hasta ahora permiten abarcar una gran cantidad de situaciones basadas en tratar de aprovechar en mayor medida uno o más recursos disponibles sobre una colección de restricciones. En el caso de los problemas de \emph{optimización combinatoria}, dicho proceso de aprovechamiento de recursos puede ser visto como un conjunto de problemas de decisión codependientes entre si sobre la utilización (o no) de cada uno de ellos. Sin embargo, en dichos problemas la relación de codependencia no queda fijada de manera explícita, sino que esta es marcada por cada problema concreto. Entonces, tiene sentido pensar que distintos problemas puedan presentar similitudes desde el punto de vista de las relaciones de dependencia entre sus variables de decisión. Para el resto de subclases de problemas la descripción se apoya en cierta medida en la jerarquía descrita en \cite{parragh2008survey} por su sencillez conceptual pero a la vez potencia desde el punto de vista de los problemas que engloba.

        \paragraph{}
        Los \emph{problemas generalizados de recogidas y entregas} se estudiaron inicialmente a partir del \emph{problema del viajante}, del cual hay registros de su existencia desde el siglo $XIX$. A pesar de ello, uno de los primeros papers que describen de manera detallada su formulación \cite{miller1960integer} no se publicaría hasta los años $60$. Con el paso de los años se ha desarrollado un amplio marco de conocimiento alrededor de este tipo de problemas, entre los que destaca especialmente \cite{toth2002vehicle}. Estos problemas surgen precisamente como una subcategoría englobada dentro del conjunto de los problemas de \emph{optimización combinatoria}. La restrición que más caracteriza este tipo de problemas se basa en el mantenimiento tanto de orden en el cumplimiento de tareass como del mantenimiento de un concepto de estado a lo largo dicho proceso. Dicho estado en algunos subproblemas es muy débil, mientras que en otros representa una componente muy importante durante el proceso de resolución del mismo.

        \paragraph{}
        En muchos casos, los \emph{problemas generalizados de recogidas y entregas} (o \emph{Vehicle Routing Problems}) pueden resumirse de la siguiente manera: Dada una colección de tareas a realizar en un determinado lugar del espacio (con posibles restricciones de orden, duración, capacidad, etc.) así como una colección de vehículos cuya función es moverse de un punto a otro en del espacio generado por las tareas (con posibles restricciones de duración, capacidad, etc.) generando un determinado incremento de coste, se trata de encontrar la \emph{ruta} (o \emph{tour}) para cada vehículo que satisface más y/o con menor coste las tareas disponibles. Entonces, dicho marco engloba una gran grantidad de problemas de optimización caracterizados por dicha restricción, donde están contenidos problemas relativamente dispares, desde el \emph{problema del viajante} (que se describirá brevemente a continuación) como el \emph{problema de recogidas y entregas} (que se describirá de manera más detallada en próximos apartados).

        \paragraph{}
        Una de las características más importantes desde el punto de vista de la resolución en este tipo de problemas es la estructura secuencial que estos presentan, así como el elevado número de variables de decisión necesario para su formulación formal. Dichas características conllevan interesantes peculiaridades que convierten en prácticamente inabordable la búsqueda de soluciones factibles utilizando técnicas de resolución genéricas. Por contra, proporcionan ciertas ventajas y simplificaciones sobre el espacio de soluciones las cuales permiten tomar una gran ventaja a métodos de resolución específicos. Entre ellas, la idea que más destaca es la una reducción de orden logarítmico del tamaño del espacio de soluciones conforme las tareas van siendo selecionadas.

        \paragraph{}
        Para la formulación de \emph{problemas generalizados de recogidas y entregas}, se utiliza una serie de restricciones comunes para poder modelar situaciones coherentes. Para ello en la \cref{eq:combinatorial_optimization_formulation} se incluye la formulación de un problema de rutas que será utilizado a modo de ejemplo. Dicha formulación se corresponde con la versión más simple del \emph{problema del viajante}. Es importante remarcar que la modelización de este problema asume que únicamente existe un vehículo. Antes de proceder con la descripción de las restricciónes es necesario describir mínimamente la notación que se utiliza en este caso: Suponemos que el problema está compuesto por $N$ tareas, que el punto de inicio se indexa con la posición $0$ (y que también deberá ser la posición final), que las variables de decisión $x_{ij}$ representan la acción de que el vehículo se desplace desde la tarea $i$-ésima hasta la tarea $j$-ésima (por lo que $X$ será una matriz de tamaño $(N + 1) x (N + 1)$) y los movimientos conllevas un coste determinado por $c_{ij}$. Además, se añade un vector auxiliar de variables de decisión $U$ de longitud $N$ el cual se explicará posterirmente. A continuación se describen dichas restricciones:

        \begin{itemize}

          \item \textbf{Unicidad}: Dado que este tipo de problemas se basan en la construcción de rutas cuyo objetivo principal es visitar una colección de tareas que representan una determinada posición en un hiperplano espacial, es necesario restringir el número de veces que estas se visitan a únicamente una. La forma de llevar a cabo esto es restringiendo el número de \emph{enlaces} entre cualquier otra tarea y la tarea encuestión (así como la tarea en cuestión y cualquier otra tarea) a uno. Esto impone tanto la restricción citada, como que todas las tareas tengan que ser visitadas (existen técnicas para relajar dicha restricción en problemas no factibles totalmente mediante la redefinición como un \emph{problemas multiobjetivo}). Entonces, en la formulación de la \cref{eq:routing_problem_formulation} las dos primeras restricciones generan la propiedad de unicidad.

          \item \textbf{Secuencialidad}: Además de construir rutas que permitan visitar todas las tareas del problema determinadas en el problema, también es necesario que dichas rutas cumplan las restricciones de secuencialidad entre un \say{enlace} y el siguiente. Comunmente este tipo de restricciones se conocen como de eliminación de subtours y es un tema ampliamente estudiado en la literatura entre las que destacan las de \emph{Miller-Tucker-Zemlin} descritas en \cite{miller1960integer}. Sin embargo, también se han desarrollado soluciones específicas para problemas generalizados de recogidas y entregas tal y como se describe en \cite{desrochers1991improvements}. En su versión más simple, estas restricciones se basan en el apoyo de un vector de variables de decisión (en nuestro caso $U$) que anotan el orden (a partir del índice o del momento temporal dependiendo de la formulación utilizada) de las tareas a partir de la cual se apoyan las restricciones para que los \say{enlaces} tengan una relación secuencial entre si. En el caso de la formulación descrita en la \cref{eq:routing_problem_formulation} esto se consigue a partir de la tercera restricción (que \say{asigna} y obliga a que exista la relación de orden en los índices anotados en el vector $U$).

        \end{itemize}

        \begin{eqfloat}
          \begin{equation}
            \begin{array}{rr@{}ll}
              \text{Minimizar} & \sum\limits_{i = 0}^{N}\sum\limits_{j = 1, j \neq i}^{N} c_{ij}x_{ij} & & \\
              \text{sujeto a}	 & \sum\limits_{i = 0, i \neq j}^{N} x_{ij} \ &= 1, & \forall i \in \{1,...,N\} \\
                               & \sum\limits_{j = 0, j \neq i}^{N} x_{ij} \ &= 1, & \forall j \in \{1,...,N\} \\
                               & u_{i} - u_{j} + Nx_{ij} \ &\leq N - 1, & 1 \leq i \neq j \leq N \\
                               &                             	x_{ij} 	&\in \{0, 1\}, 	                 & \forall i \in \{1,...,N\},\forall j \in \{1,...,N\}
            \end{array}
          \end{equation}
          \caption{Formulación de un modelo \emph{Generalizado de Recogidas y Entregas}. En concreto, el \emph{Problema del viajante}.}
          \label{eq:routing_problem_formulation}
        \end{eqfloat}

        \paragraph{}
        Tal y como se puede apreciar a partir del ejemplo anterior, modelar \emph{problemas generalizados de recogidas y entregas} es una tarea relativamente sencilla. Sin embargo, es importante remarcar que en la formulación de la \cref{eq:routing_problem_formulation} (\emph{problema del viajante}) únicamente se requiere visitar todas las tareas y la solución óptima se consigue encontrando aquella que menor coste proporcione. Sin embargo, el marco de \emph{problemas generalizados de recogidas y entregas} permite modelar situaciones mucho más complicadas. Esto se consigue ampliando las restricciones descritas inicialmente. Algunas de las más comunes se describen a continuación:

        \begin{itemize}

          \item \emph{Capacidad}: Muchos de los problemas generalizados de recogidas y entregas se basan en cargar y/o recoger una determinada mercancia para después llevar al almacén (u otro destino), por lo tanto es necesario tener en cuenta la capacidad del vehículo así como tener constancia de la ocupación del mismo en cada momento de la ruta. Dicha descripción se amplia para el caso de los \emph{problemas de recogidas y entregas} en el \cref{sec:formulation_capacity_restrictions}.

          \item \emph{Ventanas Temporales}: Las tareas no siempre perduran a lo largo del tiempo, sino que tienen unas determinadas franjas temporales en que pueden ser servidas, por lo que dicha información debe ser incluida en la formulación del modelo para que este sea lo más próximo posible a la realidad. Dicha descripción se amplia para el caso de los \emph{problemas de recogidas y entregas} en la \cref{sec:formulation_time_window_restrictions}.

          \item \emph{Duración}: Existen ocasiones en que es necesario imponer restricciones de duracción a lo largo de la ruta. Dichas restricciones pueden ser de diferentes tipos, desde el punto de vista de la duración total de la ruta, así como del tiempo que pasa desde el principio de la ruta hasta que se visita una determinada tarea, desde que se visita una determinada tarea hasta el final de la ruta, etc. Dicha descripción se amplia para el caso de los \emph{problemas de recogidas y entregas} en los \cref{sec:formulation_route_duration_restrictions,sec:formulation_trip_duration_restrictions}.

        \end{itemize}

        \paragraph{}
        Hasta ahora, se han descrito los \emph{problemas generalizados de recogidas y entregas} en los que únicamente se considera un vehículo. Sin embargo, es relativamente sencillo ampliar la formulación a casos en los cuales el modelo permite la utilización de variaos vehículos. Nótese que esto no es equivalente a la construcción de un modelo para cada vehículo ya que el objetivo es que estos se repartan tareas entre si. Para ello existen distintas formulaciones, entre las que destacan la utilización de modelos de $3$ índices (añadiendo una nueva dimensión a $X$ que determina el vehículo) o de $2$ índices (añadiendo nuevas restricciones que restringen el solapamiento de rutas). Cada una de estas alternativas presentan ventajas y desventajas que se describen más en detalle para el caso del \emph{problema de recogidas y entregas} en el \cref{sec:formulation_basic_formulation}.

        \subsubsection{Relación con problemas de Secuenciación de Tareas}
        \label{sec:routing_problems_vs_job_shop_scheduling}

          \paragraph{}
          Tras la descripción de los \emph{problemas generalizados de recogidas y entregas} es fácil darse cuenta de la gran similitud que existe con los \emph{problemas de secuenciación de tareas} ya que, al igual que estos, se basan en la optimización de un conjunto de tareas a servir. Antes de proceder con la relación y diferencias entre ambas categorías es necesario detallar que por \emph{problemas de secuenciación de tareas} nos referimos a problemas \emph{Job-Shop Scheduling}, en los cuales el objetivo es la planificación de una serie de tareas codependientes entre si de tal manera que estas se consigan resolver optimizando la duración total.

          \paragraph{}
          A pesar de que el enfoque conceptual es muy similar y tal (y como se expone en \cite{beck2003vehicle} existen diferencias muy sutiles desde el punto de vista de la formulación), tanto el objetivo como el contexto de ambas categorías de problemas es muy diferente. En \cite{beck2003vehicle} se exponen $5$ razones por las cuales deben ser considerados como dos problemas diferentes, las cuales se proceden a enumerar a continuación:

          \begin{itemize}

            \item Recursos disponibles: Generalmente los \emph{problemas generalizados de recogidas y entregas} planifican un número elevado de vehículos mientras que los \emph{problemas de secuenciación} suelen poseer un número reducido de servidores.

            \item Dependencias temporales: Los \emph{problemas generalizados de recogidas y entregas} presentan tareas independientes entre si (excepto en \emph{problemas de rutas con recogidas y entregas} como se describe en próximos apartados) mientras que los \emph{problemas de secuenciación} presentan una elevada componente de dependencias temporales entre las tareas.

            \item Estructura de tiempo: En los \emph{problemas generalizados de recogidas y entregas} el mayor peso temporal se corresponde en el proceso de enlace entre una tarea y la siguiente, mientras que en el \emph{problema de secuenciación} el peso temporal reside principalmente en la duracción de la propia tarea.

            \item Función Objetivo: En la mayoría de casos los \emph{problemas generalizados de recogidas y entregas} tratan de reducir los costes para generar los trayectos óptimos, mientras que en los \emph{problemas de optimización} el objetivo es minimizar la duración total del proceso (desde el inicio de la primera tarea hasta la finalización de la última).

            \item Ventanas Temporales: Por lo general, la mayoría de \emph{problemas generalizados de recogidas y entregas} se caracterizan por estar compuestos por \say{amplias} ventanas temporales, mientras que los \emph{problemas de secuenciación} suelen tener intervalos mucho más ajustados.

          \end{itemize}

          \paragraph{}
          A pesar de que dichas diferencias se refieren más a la estructura de la instancia específica del problema a resolver que a la propia modelización del mismo, estas también afectan en cierta manera a la forma de definir la formulación. Dichas diferencias son apreciables sobre todo desde el punto de vista de la definición de la función objetivo. Sin embargo, en el aspecto en que más se diferencian entre si es en la estrategia de resolución a seguir en cada caso desde el punto de vista de la utilización de heurísticas de búsqueda. Es fácil darse cuenta de que las estrategias que funcionen de manera adecuada con los \emph{problemas generalizados de recogidas y entregas} probablemente no se comporten como deberían en \emph{problemas de secuenciación}, y viceversa. Por todas estas razones, deben ser estudiados como problemas diferentes a pesar de tener muchas similitudes entre si.

        \paragraph{}
        Tal y como se ha descrito a lo largo del apartado, los problemas generalizados de recogidas y entregas representan un marco de modelización muy interesante que permite representar una gran cantidad de situaciones reales, desde el caso más sencillo relacionado con el \emph{problema del viajante} hasta modelizaciones muy complejas como las de empresas de reparto a gran escala que requieren de la construcción de rutas de reparto que aprovechen al máximo los recursos de la misma. El ejemplo más notable en este campo es el sistema de distribución de productos de empresas como \emph{Amazon} dado que sin técnicas de optimización sería imposible alcanzar un nivel de servicio similar sin caer en costes de servicio inmanejables.

      \subsection{Problemas de Rutas con Recogidas y Entregas}
      \label{sec:formulation_routing_pickup_and_delivery_problems}

        \paragraph{}
        Hasta ahora se ha definido la categoría de \emph{problemas generalizados de recogidas y entregas} de manera general, indicando que estos son aquellos problemas basados en la planificación de trayectos que visitan una serie de puntos definidos como tareas. Sin embargo, este es un marco muy general que a su vez permite modelar una gran cantidad de problemas. Este apartado se centra en el caso de \emph{problemas de rutas con recogidas y entregas}. Dicha modelización se caracteriza porque las tareas no solo se basan en la entrega (o recogida) de una determinada mercancia  desde (o hasta) el almacén de origen (o destino), si no que el concepto de tarea queda divido en dos. Una de ellas representa la recogida de mercancia en un determinado punto, mientras que otra representa la entrega de mercancia en otro punto diferente. Nótese que este modelo se contrapone al enfoque de los \emph{problemas de rutas} donde las mercancias son recogidas (o entregas) hasta (o desde) un almacén común.

        \paragraph{}
        Entonces, la característica de recogida y entrega en posiciones arbitrarias del hiperplano espacial sobre el cual se ha definido el problema ofrece una gran potencia desde el punto de vista de los problemas de modelización que permite representar. Sin embargo, dicha potencia conlleva una mayor dificultad desde el punto de vista de los métodos de resolución donde el espacio de soluciones es inabordable. Sin embargo, tal y como se comenta al principio del \cref{sec:formulation_generalized_pickup_and_delivery_problems} la estructura de codependencia entre variables de decisión permite tomar ventaja reduciendo notablemente el espacio de búsqueda.

        \paragraph{}
        Dentro de esta clase de problemas, es necesario hacer una importante distinción entre las dos grandes alternativas en que se pueden producir las recogidas y entregas. Estas pueden ser o no pareadas por lo tanto, a continuación se describen las diferencias más notables entre ambas clases:

        \begin{enumerate}
          \item \textbf{Pareadas}: Cuando las tareas son pareadas es necesario que exista una recogida para que haya una entrega y ambas deben cumplir la misma capacidad. Además, estas no pueden ser servidas en ordenes opuestos (primero se debe producir la recogida y después la entrega).
          \item \textbf{No Pareadas}: En el caso de problemas con tareas no pareados las limitaciones anteriormente descritas son eliminadas. Es decir, no es necesario que exista una recogida para su correspondiente entrega (y viceversa). Es de especial importancia darse cuenta de que para que esto sea posible se debe asumir que la mercancia es uniforme entre si (al menos en la formulación más básica) de tal manera que pueda ser intercambiable entre todas las tareas.
        \end{enumerate}

      \subsection{Problemas Dial-a-Ride}
      \label{sec:formulation_dial_a_ride_problems}

        \paragraph{}
        El \emph{problema Dial-a-Ride} se engloba dentro del marco de los \emph{problemas de rutas con recogidas y entregas} donde las tareas son pareadas entre si. Es decir, donde existe una tarea que representa la recogida con una capacidad igual a la de su correspondiente tarea de entrega, y además estas han de ser realizadas siguiendo un orden estricto. A este tipo de problemas se les conoce como \emph{problemas de recogidas y entregas} o \emph{Pickup and Delivery Problem} (\emph{PDP}). Es en esta categoría de problemas donde surge el concepto de \emph{viaje}, que se define como el trayecto dentro de una ruta que realiza cada una de las mercancias desde que estas se recogen hasta que se entregan. Nótese entonces que cada viaje esta formado por dos tareas.

        \paragraph{}
        A pesar de que el \emph{problema Dial-a-Ride} pertenece a la categoría de \emph{problemas de recogidas y entregas}, este se caracteriza porque la mercancia a transportar está formada por personas (siendo el ejemplo más significativo el problema de planificación de una compañía de taxis), lo cual implica la creación de restricciones adicionales. Típicamente se añaden restricciones que limitan la duración máxima de cada uno de los viajes a un tiempo máximo, algo que no es tan importante en el caso de mercancias pero si en el de personas.

        \paragraph{}
        [TODO]

        \subsubsection{Aplicaciones en Situaciones Reales}
        \label{sec:formulation_dial_a_ride_applications}

          \paragraph{}
          [TODO]

        \paragraph{}
        [TODO]

    \section{Notación}
    \label{sec:formulation_notation}

      \paragraph{}
      [TODO]

      \begin{itemize}
        \item $V_{i}$: [TODO]
        \item $A_{l}$: [TODO]
        \item $K_{k}$: [TODO]
      \end{itemize}

      \paragraph{}
      [TODO]


    \section{Formulación básica}
    \label{sec:formulation_basic_formulation}

      \paragraph{}
      Modelización basada en \cite{parragh2008survey}. [TODO]


      \begin{eqfloat}
				\begin{equation}
					\begin{array}{rr@{}ll}
  					\text{Minimizar} & \displaystyle\sum\limits_{k \in K}\sum\limits_{(i, j) \in A}  c_{ij}^{k}x_{ij}^{k} &                 & \\
						\text{sujeto a}	 & \displaystyle\sum\limits_{k \in K}\sum\limits_{j: (i, j) \in A} x_{0j}^{k} \ &= 1,                      & \forall i \in P \cup D \\
                             & \displaystyle\sum\limits_{j: (0, j) \in A} x_{i,n+\tilde{n} + 1}^{k}  \ &= 1, 	                          & \forall k \in K \\
                             & \displaystyle\sum\limits_{i: (i, n + \tilde{n} + 1) \in A} x_{ij}^{k} \ &= 1, 	                          & \forall k \in K \\
                             & \displaystyle\sum\limits_{i: (i, j) \in A} x_{ij}^{k} - \sum\limits_{j: (j, i) \in A} x_{ij}^{k} \ &= 0, & \forall j \in P \cup D, \forall k \in K \\
                             & x_{ij}^{k} = 1, \implies B_{j}^{k} \ &\geq B_{i}^{k} + d_{i} + t_{ij}^{k} 	                          & \forall (i, j) \in A, \forall k \in K \\
                             & x_{ij}^{k} = 1, \implies Q_{j}^{k} \ &= Q_{i}^{k} + q_{j} 	                          & \forall (i, j) \in A, \forall k \in K \\
                             & max\{0, q_{i}\} \ &\leq Q_{i}^k 	                          & \forall i \in V, \forall k \in K \\
                             & Q_{i}^k \ &\leq min\{C^{k}, C^{k} + q_{i}\} 	                          & \forall i \in V, \forall k \in K \\
														 &                               	x_{j} 	&\in \{0,1\}, 	                 & \forall j \in \{1,...,n\} \\
					\end{array}
				\end{equation}
				\caption{[TODO]}
				\label{eq:basic_formulation}
			\end{eqfloat}

      \paragraph{}
      [TODO]

    \section{Restricciones Addicionales}
    \label{sec:formulation_aditional_restrictions}

      \paragraph{}
      [TODO]

      \subsection{Capacidad}
      \label{sec:formulation_capacity_restrictions}

        \paragraph{}
        [TODO]

      \subsection{Ventanas Temporales}
      \label{sec:formulation_time_window_restrictions}

        \paragraph{}
        [TODO]

      \subsection{Duración de viaje}
      \label{sec:formulation_trip_duration_restrictions}

        \paragraph{}
        [TODO]

      \subsection{Duración de ruta}
      \label{sec:formulation_route_duration_restrictions}

        \paragraph{}
        [TODO]

    \section{Funciones Objetivo}
    \label{sec:formulation_objective_functions}
      [TODO]

      \subsection{Pickup and Delivery}
      \label{sec:formulation_pickup_and_delivery}

        \paragraph{}
        [TODO]

      \subsection{Dial a Ride}
      \label{sec:formulation_dial_a_ride}

        \paragraph{}
        [TODO]

      \subsection{Taxi Sharing}
      \label{sec:formulation_taxi_sharing}

        \paragraph{}
        [TODO]

    \section{Tiempo Real}
    \label{sec:formulation_real_time}

      \paragraph{}
      [TODO]

    \section{Conclusiones}
    \label{sec:formulation_conclusions}

      \paragraph{}
      [TODO]

\end{document}
